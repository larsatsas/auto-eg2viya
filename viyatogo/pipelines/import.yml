prepare-target:
  tags:
    - viyatogo-import
  stage: import
  script:
  # init env variables
    - whoami
    - export SSL_CERT_FILE=~/certs/server-cacerts.pem
    - export REQUESTS_CA_BUNDLE=${SSL_CERT_FILE}
    - /opt/pyviyatools/loginviauthinfo.py
# setup startup and autoexec for compute, batch and sas studio
    - echo "Configure startup and autoexec for compute and batch as well as fileshare in sas studio"
    - sas-viya configuration configurations update --file viyatogo/config/compute-startup_commands.json
    - sas-viya configuration configurations update --file viyatogo/config/compute-autoexec.json
    - sas-viya configuration configurations update --file viyatogo/config/batch-autoexec.json


import-EGProjects:   # This job imports prepared content to target sas viya environment.
  tags:
    - viyatogo-import
  stage: import  
  script:
    - echo "Importing EG Projects"
    - export SSL_CERT_FILE=~/certs/server-cacerts.pem
    - export REQUESTS_CA_BUNDLE=${SSL_CERT_FILE}
    - /opt/pyviyatools/loginviauthinfo.py
    - viyatogo/utilities/importEGProjects --sas-viya-path /usr/local/bin/sas-viya --source-file "exported/list_of_Enterprise_Guide_Projects.csv" --root-folder "Public"
  needs: ["prepare-target"]

import-DISASPackages:
  tags:
    - viyatogo-import
  stage: import
  script:
    - echo "Importing DI SAS packages"
    - export SSL_CERT_FILE=~/certs/server-cacerts.pem
    - export REQUESTS_CA_BUNDLE=${SSL_CERT_FILE}
    - /opt/pyviyatools/loginviauthinfo.py
# finance - DIFT Parameterized job 
    - viyatogo/utilities/importSASPackages --sas-viya-path /usr/local/bin/sas-viya --source-location "exported/DISASPackages/gelcorp/financecontent/DataSupport"
  needs: ["prepare-target"]

