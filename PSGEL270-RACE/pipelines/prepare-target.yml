cleanup-target:
  tags:
    - PSGEL270-Race
  stage: prepare-target
  script:
    - sh PSGEL270-RACE/utilities/resetViya.sh ||  exit_code=$?
    - if [ $exit_code -ne 0 ]; then echo $exit_code; fi;

prepare-target:
  tags:
    - PSGEL270-Race
  stage: prepare-target
  script:
  # init env variables
    - whoami
    - gel_setCurrentNamespace target
    - export SAS_CLI_PROFILE=${current_namespace}
    - export SSL_CERT_FILE=~/.certs/${current_namespace}_trustedcerts.pem
    - export REQUESTS_CA_BUNDLE=${SSL_CERT_FILE}
    - /opt/pyviyatools/loginviauthinfo.py
# setup startup and autoexec for compute, batch and sas studio
    - echo "Configure startup and autoexec for compute and batch as well as fileshare in sas studio"
    - sas-viya configuration configurations update --file PSGEL270-RACE/config/compute-startup_commands.json
    - sas-viya configuration configurations update --file PSGEL270-RACE/config/compute-autoexec.json
    - sas-viya configuration configurations update --file PSGEL270-RACE/config/batch-autoexec.json
    - sas-viya configuration configurations update --file PSGEL270-RACE/config/update_studio.json
