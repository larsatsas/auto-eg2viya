import-EGProjects:   # This job imports prepared content to target sas viya environment.
  tags:
    - PSGEL270-Race
  stage: import  
  script:
    - echo "Importing EG Projects"
    - gel_setCurrentNamespace target
    - export SAS_CLI_PROFILE=${current_namespace}
    - export SSL_CERT_FILE=~/.certs/${current_namespace}_trustedcerts.pem
    - export REQUESTS_CA_BUNDLE=${SSL_CERT_FILE}
    - /opt/pyviyatools/loginviauthinfo.py
    - viyatogo/utilities/importEGProjects --sas-viya-path /usr/bin/sas-viya --source-file "exported/list_of_Enterprise_Guide_Projects.csv" --root-folder "Public"

import-DISASPackages:
  tags:
    - PSGEL270-Race
  stage: import
  script:
    - echo "Importing DI SAS packages"
    - gel_setCurrentNamespace target
    - export SAS_CLI_PROFILE=${current_namespace}
    - export SSL_CERT_FILE=~/.certs/${current_namespace}_trustedcerts.pem
    - export REQUESTS_CA_BUNDLE=${SSL_CERT_FILE}
    - /opt/pyviyatools/loginviauthinfo.py
# finance - DIFT Parameterized job 
    - viyatogo/utilities/importSASPackages --sas-viya-path /usr/bin/sas-viya --source-location "exported/DISASPackages/gelcorp/financecontent/DataSupport"


load-migration-data:
  needs:
    - import-EGProjects
    - import-DISASPackages
  tags:
    - PSGEL270-Race
  stage: load-migration-data
  script:
    - echo "Loading migration data for the migration summary report"
    - gel_setCurrentNamespace target
    - kubectl create job loadimportdata-001 --from=cronjob/sas-import-data-loader
    - sleep 20
    - kubectl logs -f job/loadimportdata-001 | klog
    - kubectl delete job loadimportdata-001

